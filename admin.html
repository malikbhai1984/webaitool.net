<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - WebAITool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; background: #1a1a2e; color: white; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { font-size: 32px; color: #00ce79; }
        .box { background: #16213e; padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #0f3460; }
        .box h3 { color: #00ce79; margin-bottom: 15px; }
        input, textarea, select { padding: 10px; border-radius: 6px; border: none; margin: 5px; width: calc(33% - 10px); }
        textarea { width: calc(100% - 10px); }
        button { padding: 10px 20px; cursor: pointer; border-radius: 6px; border: none; font-weight: bold; background: #00ce79; color: white; margin: 5px; }
        button:hover { background: #00a35e; }
        .edit-btn { background: #3498db; }
        .del-btn { background: #ff4757; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border-bottom: 1px solid #0f3460; text-align: left; font-size: 13px; }
        th { background: #0f3460; color: #00ce79; }
        .sub-item { padding-left: 30px; background: #0f1e2e; }
        .preview-img { width: 50px; height: 50px; object-fit: cover; border-radius: 5px; }
        
        /* Drag & Drop Styles */
        .tool-row {
            cursor: move;
            transition: background 0.3s;
        }
        .tool-row:hover {
            background: #1e2642 !important;
        }
        .tool-row.dragging {
            opacity: 0.5;
            background: #00ce79 !important;
        }
        .tool-row.drag-over {
            border-top: 3px solid #00ce79;
        }
        
        @media (max-width: 768px) { input, select { width: calc(100% - 10px); } }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîê Admin Control Panel</h1>
        <p>Separate Parent Menu & Dropdown Sub-Menu Management</p>
    </div>

    <!-- SECTION 1: Parent Menu (Top Level - No Links) -->
    <div class="box">
        <h3>1Ô∏è‚É£ Parent Menu Management (Top Level Container)</h3>
        <p style="color:#bbb; margin-bottom:10px; font-size:13px;">üí° Parent menus are containers for dropdowns. No link needed.</p>
        <input type="text" id="parentName" placeholder="Parent Menu Name (e.g., Tools)">
        <input type="text" id="parentLink" placeholder="Link (Optional, e.g., # or tools.html)">
        <button onclick="addParentMenu()" id="parentBtn">‚ûï Add Parent Menu</button>
        <button onclick="cancelParentEdit()" id="cancelParentBtn" style="display:none; background:#6c757d;">‚ùå Cancel</button>
        <table id="parentTable"></table>
    </div>

    <!-- SECTION 2: Dropdown Sub-Menu (Under Parent - With Links) -->
    <div class="box">
        <h3>2Ô∏è‚É£ Dropdown Sub-Menu Management (Under Parent)</h3>
        <p style="color:#bbb; margin-bottom:10px; font-size:13px;">üí° Sub-menus appear in dropdown under parent menus.</p>
        <input type="text" id="subName" placeholder="Sub-Menu Name (e.g., Image Tools)">
        <input type="text" id="subLink" placeholder="Link (Required, e.g., image-tools.html)">
        <select id="subParent">
            <option value="">Select Parent Menu</option>
        </select>
        <button onclick="addSubMenu()" id="subBtn">‚ûï Add Sub-Menu</button>
        <button onclick="cancelSubEdit()" id="cancelSubBtn" style="display:none; background:#6c757d;">‚ùå Cancel</button>
        <table id="subTable"></table>
    </div>

    <!-- Tools with Image Upload + Drag & Drop -->
    <div class="box">
        <h3>3Ô∏è‚É£ Tool Categories (Drag & Drop to Reorder)</h3>
        <p style="color:#bbb; margin-bottom:10px; font-size:13px;">üí° Drag tools to reorder. Changes will reflect on homepage.</p>
        <input type="text" id="tName" placeholder="Tool Name">
        <input type="text" id="tIcon" placeholder="Icon" value="üîß">
        <input type="text" id="tLink" placeholder="Link">
        <input type="file" id="tImage" accept="image/*" onchange="previewImage()">
        <textarea id="tDesc" rows="2" placeholder="Description"></textarea>
        <select id="parentTool">
            <option value="">Main Category</option>
        </select>
        <div id="imagePreview" style="margin:10px 0;"></div>
        <button onclick="addTool()" id="toolBtn">‚ûï Add Tool</button>
        <button onclick="cancelToolEdit()" id="cancelToolBtn" style="display:none; background:#6c757d;">‚ùå Cancel</button>
        <div id="toolTableContainer"></div>
    </div>

    <!-- Cards Per Row -->
    <div class="box">
        <h3>4Ô∏è‚É£ Cards Per Row</h3>
        <select id="cardsPerRow" onchange="saveCardsPerRow()">
            <option value="2">2 Cards</option>
            <option value="3">3 Cards</option>
            <option value="4">4 Cards</option>
        </select>
        <p style="margin-top:10px;">Current: <span id="currentCards"></span></p>
    </div>

    <!-- Footer -->
    <div class="box">
        <h3>5Ô∏è‚É£ Footer Text</h3>
        <textarea id="footerText" rows="2"></textarea>
        <button onclick="saveFooter()">üíæ Save</button>
    </div>

    <button style="background:#6c5ce7;" onclick="window.location.href='index.html'">üëÅÔ∏è View Site</button>
    <button style="background:#f1c40f; color:black;" onclick="resetAll()">üîÑ Reset</button>

    <script>
        let editingParentIndex = null;
        let editingSubIndex = null;
        let editingToolIndex = null;
        let currentImageBase64 = '';

        if (!localStorage.getItem('initialized')) {
            localStorage.setItem('parentMenus', JSON.stringify([
                {name: 'Home', link: 'index.html'},
                {name: 'Tools', link: '#'},
                {name: 'Contact', link: 'contact.html'}
            ]));
            
            localStorage.setItem('subMenus', JSON.stringify([
                {name: 'Image Tools', link: 'image-tools.html', parent: '1'},
                {name: 'PDF Tools', link: 'pdf-tools.html', parent: '1'},
                {name: 'QR Tools', link: 'qr-tools.html', parent: '1'}
            ]));
            
            localStorage.setItem('toolItems', JSON.stringify([
                {name: 'üñºÔ∏è Image Tools', desc: 'Image processing', link: 'image-tools.html', icon: 'üñºÔ∏è', image: '', parent: ''}
            ]));
            
            localStorage.setItem('cardsPerRow', '3');
            localStorage.setItem('footerText', '¬© 2024 WebAITool.net');
            localStorage.setItem('initialized', 'true');
        }

        function loadTables() {
            // Parent Menu Table
            const parents = JSON.parse(localStorage.getItem('parentMenus')) || [];
            let parentHTML = '<tr><th>Menu Name</th><th>Link (Optional)</th><th>Actions</th></tr>';
            parents.forEach((p, i) => {
                parentHTML += `
                    <tr>
                        <td><strong>${p.name}</strong></td>
                        <td>${p.link || '-'}</td>
                        <td>
                            <button class="edit-btn" onclick="editParent(${i})">‚úèÔ∏è Edit</button>
                            <button class="del-btn" onclick="deleteParent(${i})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('parentTable').innerHTML = parentHTML;

            // Update parent dropdown for sub-menus
            const subParentSelect = document.getElementById('subParent');
            subParentSelect.innerHTML = '<option value="">Select Parent Menu</option>' + 
                parents.map((p, i) => `<option value="${i}">${p.name}</option>`).join('');

            // Sub-Menu Table
            const subs = JSON.parse(localStorage.getItem('subMenus')) || [];
            let subHTML = '<tr><th>Sub-Menu Name</th><th>Link</th><th>Parent</th><th>Actions</th></tr>';
            subs.forEach((s, i) => {
                const parentName = parents[parseInt(s.parent)]?.name || 'None';
                subHTML += `
                    <tr class="sub-item">
                        <td>‚Ü≥ ${s.name}</td>
                        <td>${s.link}</td>
                        <td>${parentName}</td>
                        <td>
                            <button class="edit-btn" onclick="editSub(${i})">‚úèÔ∏è Edit</button>
                            <button class="del-btn" onclick="deleteSub(${i})">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            });
            document.getElementById('subTable').innerHTML = subHTML;

            // Tool Table with Drag & Drop
            const tools = JSON.parse(localStorage.getItem('toolItems')) || [];
            const parentToolSelect = document.getElementById('parentTool');
            const mainTools = tools.filter(t => !t.parent || t.parent === '');
            parentToolSelect.innerHTML = '<option value="">Main Category</option>' + 
                mainTools.map((t, i) => {
                    const actualIndex = tools.findIndex(item => item.name === t.name);
                    return `<option value="${actualIndex}">${t.name}</option>`;
                }).join('');

            let toolHTML = '<table id="toolTable"><tr><th>Drag</th><th>Image</th><th>Icon</th><th>Name</th><th>Link</th><th>Actions</th></tr>';
            tools.forEach((t, i) => {
                const isSubItem = t.parent !== '' && t.parent !== undefined;
                toolHTML += `
                    <tr class="tool-row ${isSubItem ? 'sub-item' : ''}" draggable="true" data-index="${i}">
                        <td style="cursor:move;">‚ò∞</td>
                        <td>${t.image ? `<img src="${t.image}" class="preview-img">` : '-'}</td>
                        <td>${isSubItem ? '‚Ü≥ ' : ''}${t.icon}</td>
                        <td>${t.name}</td>
                        <td>${t.link}</td>
                        <td>
                            <button class="edit-btn" onclick="editTool(${i})">‚úèÔ∏è</button>
                            <button class="del-btn" onclick="deleteTool(${i})">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });
            toolHTML += '</table>';
            document.getElementById('toolTableContainer').innerHTML = toolHTML;

            // Add drag & drop event listeners
            addDragAndDrop();

            const cards = localStorage.getItem('cardsPerRow') || '3';
            document.getElementById('cardsPerRow').value = cards;
            document.getElementById('currentCards').textContent = cards + ' cards';

            document.getElementById('footerText').value = localStorage.getItem('footerText') || '';
        }

        // Drag & Drop Functions
        let draggedIndex = null;

        function addDragAndDrop() {
            const rows = document.querySelectorAll('.tool-row');
            
            rows.forEach(row => {
                row.addEventListener('dragstart', function(e) {
                    draggedIndex = parseInt(this.dataset.index);
                    this.classList.add('dragging');
                });

                row.addEventListener('dragend', function(e) {
                    this.classList.remove('dragging');
                    document.querySelectorAll('.tool-row').forEach(r => r.classList.remove('drag-over'));
                });

                row.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('drag-over');
                });

                row.addEventListener('dragleave', function(e) {
                    this.classList.remove('drag-over');
                });

                row.addEventListener('drop', function(e) {
                    e.preventDefault();
                    const dropIndex = parseInt(this.dataset.index);
                    
                    if (draggedIndex !== dropIndex) {
                        // Reorder tools array
                        const tools = JSON.parse(localStorage.getItem('toolItems'));
                        const draggedItem = tools[draggedIndex];
                        tools.splice(draggedIndex, 1);
                        tools.splice(dropIndex, 0, draggedItem);
                        localStorage.setItem('toolItems', JSON.stringify(tools));
                        loadTables();
                    }
                    
                    this.classList.remove('drag-over');
                });
            });
        }

        // PARENT MENU CRUD
        function addParentMenu() {
            const name = document.getElementById('parentName').value.trim();
            const link = document.getElementById('parentLink').value.trim() || '#';
            
            if (!name) return alert('‚ö†Ô∏è Enter Parent Menu Name!');
            
            const parents = JSON.parse(localStorage.getItem('parentMenus')) || [];
            
            if (editingParentIndex !== null) {
                parents[editingParentIndex] = {name, link};
                editingParentIndex = null;
                document.getElementById('parentBtn').textContent = '‚ûï Add Parent Menu';
                document.getElementById('cancelParentBtn').style.display = 'none';
                alert('‚úÖ Parent Menu Updated!');
            } else {
                parents.push({name, link});
                alert('‚úÖ Parent Menu Added!');
            }
            
            localStorage.setItem('parentMenus', JSON.stringify(parents));
            document.getElementById('parentName').value = '';
            document.getElementById('parentLink').value = '';
            loadTables();
        }

        function editParent(i) {
            const parents = JSON.parse(localStorage.getItem('parentMenus'));
            document.getElementById('parentName').value = parents[i].name;
            document.getElementById('parentLink').value = parents[i].link;
            editingParentIndex = i;
            document.getElementById('parentBtn').textContent = 'üíæ Update Parent';
            document.getElementById('cancelParentBtn').style.display = 'inline-block';
        }

        function cancelParentEdit() {
            editingParentIndex = null;
            document.getElementById('parentName').value = '';
            document.getElementById('parentLink').value = '';
            document.getElementById('parentBtn').textContent = '‚ûï Add Parent Menu';
            document.getElementById('cancelParentBtn').style.display = 'none';
        }

        function deleteParent(i) {
            if (!confirm('üóëÔ∏è Delete this parent menu? All sub-menus under it will also be deleted.')) return;
            
            const parents = JSON.parse(localStorage.getItem('parentMenus'));
            const subs = JSON.parse(localStorage.getItem('subMenus')) || [];
            
            // Delete all sub-menus under this parent
            const updatedSubs = subs.filter(s => s.parent != i);
            localStorage.setItem('subMenus', JSON.stringify(updatedSubs));
            
            parents.splice(i, 1);
            localStorage.setItem('parentMenus', JSON.stringify(parents));
            
            alert('‚úÖ Parent Menu & Sub-Menus Deleted!');
            loadTables();
        }

        // SUB-MENU CRUD
        function addSubMenu() {
            const name = document.getElementById('subName').value.trim();
            const link = document.getElementById('subLink').value.trim();
            const parent = document.getElementById('subParent').value;
            
            if (!name || !link) return alert('‚ö†Ô∏è Enter Sub-Menu Name and Link!');
            if (!parent) return alert('‚ö†Ô∏è Select Parent Menu!');
            
            const subs = JSON.parse(localStorage.getItem('subMenus')) || [];
            
            if (editingSubIndex !== null) {
                subs[editingSubIndex] = {name, link, parent};
                editingSubIndex = null;
                document.getElementById('subBtn').textContent = '‚ûï Add Sub-Menu';
                document.getElementById('cancelSubBtn').style.display = 'none';
                alert('‚úÖ Sub-Menu Updated!');
            } else {
                subs.push({name, link, parent});
                alert('‚úÖ Sub-Menu Added!');
            }
            
            localStorage.setItem('subMenus', JSON.stringify(subs));
            document.getElementById('subName').value = '';
            document.getElementById('subLink').value = '';
            document.getElementById('subParent').value = '';
            loadTables();
        }

        function editSub(i) {
            const subs = JSON.parse(localStorage.getItem('subMenus'));
            document.getElementById('subName').value = subs[i].name;
            document.getElementById('subLink').value = subs[i].link;
            document.getElementById('subParent').value = subs[i].parent;
            editingSubIndex = i;
            document.getElementById('subBtn').textContent = 'üíæ Update Sub-Menu';
            document.getElementById('cancelSubBtn').style.display = 'inline-block';
        }

        function cancelSubEdit() {
            editingSubIndex = null;
            document.getElementById('subName').value = '';
            document.getElementById('subLink').value = '';
            document.getElementById('subParent').value = '';
            document.getElementById('subBtn').textContent = '‚ûï Add Sub-Menu';
            document.getElementById('cancelSubBtn').style.display = 'none';
        }

        function deleteSub(i) {
            if (!confirm('üóëÔ∏è Delete this sub-menu?')) return;
            
            const subs = JSON.parse(localStorage.getItem('subMenus'));
            subs.splice(i, 1);
            localStorage.setItem('subMenus', JSON.stringify(subs));
            
            alert('‚úÖ Sub-Menu Deleted!');
            loadTables();
        }

        // TOOL CRUD (Same as before)
        function previewImage() {
            const file = document.getElementById('tImage').files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                currentImageBase64 = e.target.result;
                document.getElementById('imagePreview').innerHTML = 
                    `<img src="${currentImageBase64}" style="width:100px; border-radius:8px;">`;
            };
            reader.readAsDataURL(file);
        }

        function addTool() {
            const name = document.getElementById('tName').value.trim();
            const icon = document.getElementById('tIcon').value.trim();
            const link = document.getElementById('tLink').value.trim();
            const desc = document.getElementById('tDesc').value.trim();
            const parent = document.getElementById('parentTool').value;
            if (!name || !link || !desc) return alert('Fill all fields!');
            
            const tools = JSON.parse(localStorage.getItem('toolItems')) || [];
            
            if (editingToolIndex !== null) {
                tools[editingToolIndex] = {name, icon, link, desc, image: currentImageBase64, parent};
                editingToolIndex = null;
                document.getElementById('toolBtn').textContent = '‚ûï Add Tool';
                document.getElementById('cancelToolBtn').style.display = 'none';
            } else {
                tools.push({name, icon, link, desc, image: currentImageBase64, parent});
            }
            
            localStorage.setItem('toolItems', JSON.stringify(tools));
            document.getElementById('tName').value = '';
            document.getElementById('tIcon').value = 'üîß';
            document.getElementById('tLink').value = '';
            document.getElementById('tDesc').value = '';
            document.getElementById('tImage').value = '';
            document.getElementById('parentTool').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            currentImageBase64 = '';
            loadTables();
        }

        function editTool(i) {
            const tools = JSON.parse(localStorage.getItem('toolItems'));
            document.getElementById('tName').value = tools[i].name;
            document.getElementById('tIcon').value = tools[i].icon;
            document.getElementById('tLink').value = tools[i].link;
            document.getElementById('tDesc').value = tools[i].desc;
            document.getElementById('parentTool').value = tools[i].parent || '';
            currentImageBase64 = tools[i].image || '';
            if (currentImageBase64) {
                document.getElementById('imagePreview').innerHTML = 
                    `<img src="${currentImageBase64}" style="width:100px; border-radius:8px;">`;
            }
            editingToolIndex = i;
            document.getElementById('toolBtn').textContent = 'üíæ Update';
            document.getElementById('cancelToolBtn').style.display = 'inline-block';
        }

        function cancelToolEdit() {
            editingToolIndex = null;
            document.getElementById('tName').value = '';
            document.getElementById('tIcon').value = 'üîß';
            document.getElementById('tLink').value = '';
            document.getElementById('tDesc').value = '';
            document.getElementById('tImage').value = '';
            document.getElementById('parentTool').value = '';
            document.getElementById('imagePreview').innerHTML = '';
            currentImageBase64 = '';
            document.getElementById('toolBtn').textContent = '‚ûï Add Tool';
            document.getElementById('cancelToolBtn').style.display = 'none';
        }

        function deleteTool(i) {
            if (!confirm('Delete?')) return;
            const tools = JSON.parse(localStorage.getItem('toolItems'));
            tools.splice(i, 1);
            localStorage.setItem('toolItems', JSON.stringify(tools));
            loadTables();
        }

        function saveCardsPerRow() {
            localStorage.setItem('cardsPerRow', document.getElementById('cardsPerRow').value);
            document.getElementById('currentCards').textContent = document.getElementById('cardsPerRow').value + ' cards';
            alert('Saved!');
        }

        function saveFooter() {
            localStorage.setItem('footerText', document.getElementById('footerText').value);
            alert('Footer saved!');
        }

        function resetAll() {
            if (!confirm('Reset all?')) return;
            localStorage.clear();
            location.reload();
        }

        loadTables();
    </script>
</body>
</html>
